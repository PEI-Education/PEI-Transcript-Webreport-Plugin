<queries>
  <query name="ca.pei.reporting.transcript.get_transcript_data" coreTable="students" flattened="true" tags="transcript">
    <summary>Student transcript data</summary>
    <description>Retrieves all data necessary to generate a PEI student transcript.</description>
    <columns>
      <column column="students.dcid">dcid</column>
      <column column="students.id">id</column>
      <column column="students.first_name">first_name</column>
      <column column="students.last_name">last_name</column>
      <column column="students.dob">dob</column>
      <column column="students.schoolid">schoolid</column>
      <column column="students.student_number">student_number</column>
    </columns>
    <sql><![CDATA[
      with selectedstudents as (select DCID,
          ID,
          FIRST_NAME,
          LAST_NAME,
          DOB,
          SCHOOLID,
          STUDENT_NUMBER
      from students where <@restricted_table table="students" selector="selectedstudents"/>)
      select 
          DCID,
          ID,
          FIRST_NAME,
          LAST_NAME,
          DOB,
          SCHOOLID,
          STUDENT_NUMBER
		from SELECTEDSTUDENTS
    ]]></sql>
  </query>
</queries>